// ---------- EDIT THESE LATER ----------
const artistBio = `
Kye Alfred Hillig is a songwriter from Tacoma, Washington, drawn to the city’s grand dysfunction and uninterested in seeing it cleaned up for comfort. The stories there are heartbreaking and endless, and it is where he returned after dropping out of art school in the early 2000s. He has spent years working in social services, close to the raw material of modern life, and his songs carry that weight without dressing it up.

It is hard to say exactly what his problem is, but something is always wrong. Maybe it is the daily proximity to other people’s crises. Maybe it is the stubborn grind of trying to make art inside a world that keeps asking you to be smaller. Maybe it is just the divine torture chamber of being alive right now. Whatever dog bit him still has its teeth in the music.

Over the last two decades Hillig has moved through the Puget Sound with a complete disregard for genre, serving as principal songwriter in bands like Destruction Island and Pistol For A Paycheck before stepping out as a solo artist in 2012. His new material sits in the overlap of indie rock, singer-songwriter, and alt-pop. The melodies are immediate, the hooks are sharp, and the point is always the same. Tell the truth, even when it is ugly. With his upcoming release, Hillig delivers his ninth solo album, spanked and screaming.
`;

const tracks = [
  {
    title: "The Horrible Truth",
    file: "audio/01 The Horrible Truth.mp3",
    notes: "(add notes later)",
    credits: "(add credits later)",
    lyrics: `Ran some errands
Made a friend call back,
But we never made love today
Never said goodbye to my old friend Matt
He went to bed,
But he couldn’t awake
Hold the door
Hold my whole damn life
I guess it was never really mine
God forgave, but he never gave back
The paint flaking off with time

You can’t escape it, dear
So I might as well confess to you
What’s so hard to hear
All this horrible truth

Down to the cellar
Fill the washing machine,
But I never got out your stains
What’s the point of laundry if it never comes clean?
Or a love that’s dying and grey?
It’s the hope that makes you feel foolish
The stupid way I chased you around
All the wasted days I tried so hard to prove it
Like the lost could ever be found

You can’t escape it, dear
So I might as well confess to you
What’s so hard to hear
All this horrible truth

Stepping out
Got an obligation
A phone call you’ve gotta take
It’s my fault
I should made an appointment
You’re probably busy anyway
After a while all you’ve got is strangers
Two actors putting on a play
Taking bows and catching all the roses,
But the curtain’s falling on the stage

You can’t escape it, dear
So I might as well confess to you
What’s so hard to hear
All this horrible truth`
  },
  {
    title: "Ezekiel Bobbing For Apples",
    file: "audio/02 Ezekiel Bobbing For Apples.mp3",
    notes: "(add notes later)",
    credits: "(add credits later)",
    lyrics: `Open up our hearts for nothing
That is what we do
Open up our hearts for nothing
That is what we do
Peace on Earth and all that shit,
But none of it comes true
Open up our hearts for nothing
That is what we do

Open up those country doors
Let the caged birds go free
But where they’ve flown there’s nothing grown
Perched in a fruitless tree
And I was looking in the mirror
Just as you were walking away from me
But what I saw would be hard to draw
It didn’t look like anything

Open up our hearts for nothing
That is what we do
Open up our hearts for nothing
That is what we do
Peace on Earth and all that shit,
But none of it comes true
Open up our hearts for nothing
That is what we do

Down the road I saw a home
Without windows or a wife
I went indoors, just walked the floors
No, I couldn’t sleep that night
In the morning the sun rose high
And I let it kiss my face
But it weren’t your lips
Just a counterfeit
Some things you can’t replace

Open up our hearts for nothing
That is what we do
Open up our hearts for nothing
That is what we do
Peace on Earth and all that shit,
But none of it comes true
Open up our hearts for nothing
That is what we do
Open up our hearts for nothing
That is what we do
Open up our hearts for nothing
That is what we do
Open up our hearts for nothing
That is what we do…`
  },
  {
    title: "Divorce of Course of Course",
    file: "audio/03 Divorce of Course of Course.mp3",
    notes: "(add notes later)",
    credits: "(add credits later)",
    lyrics: `Love me in these shackles fit for justice
Show me how my heart can break
Meet me on the map of Nova Scotia, hoping for a holiday
Crasser than life when you go down on me
Choking like there’s nothing wrong
Just a million little birds on a dead dogs fur
Trying to make a corpse their home

And oh we often get it wrong,
But so what move on
So what move on!

Trying to stand apart from other women
Acrylic and styrofoam
A capital bridge to leap to laughter
Before you left my heart alone
Calling out my name like it don’t mean nothing
Like a hooker in my dressing room
Taking back what you said to the man on the ledge hoping for a honeymoon

And oh we often get it wrong,
But so what move on
So what move on!

Music in the way we held each other
Blood boiling in the kitchen sink
Now we’re on this earth like a stolen purse
Trying to find the missing keys
Tell me of your sadness ‘cause it sounds like glory
Like the pieces that I try to hide
But we’re giving birth to a life that hurts
And it’s really alright to cry

And oh we often get it wrong,
But so what move on
So what move on!`
  },
  {
    title: "Don't Cancel The Fair",
    file: "audio/04 Don't Cancel The Fair.mp3",
    notes: "(add notes later)",
    credits: "(add credits later)",
    lyrics: `Don’t cancel the fair
I don’t know what we’re gonna do come Spring
Just sit around and drink?
And lay off all the clowns?
And leave the bulls out in the fields for now
We gotta figure this out

And what are we gonna do with ourselves come June?
Alone with our thoughts in the quiet of this room
I hope there’s a thousand people there
Please don’t cancel the fair

Don’t take the giant pumpkins home
I want the bright blue jackets of the FFA
I want the grange displays
And a burger as big as your head
And an old man dragging his oxygen tank down passed the carnival games

And what are we gonna do with ourselves come June?
Alone with our thoughts in the quiet of this room
I hope there’s a thousand people there
Please don’t cancel the fair

Don’t turn off all the lights,
Close the gates, and send the country singers home
To sing sad songs alone
And that little boy by the slide?
Looks like me back when I was his age
Oh please just let him stay

And what are we gonna do with ourselves come June?
Alone with our thoughts in the quiet of this room
I hope there’s a thousand people there
Please don’t cancel the fair`
  },
  {
    title: "How Desperate We Are",
    file: "audio/05 How Desperate We Are.mp3",
    notes: "(add notes later)",
    credits: "(add credits later)",
    lyrics: `How desperate we are
How desperate we are
And if you want to know how close to the bottom
Just count the churches, jails, & bars

You say the road is heading south
Like there’s another way to go
Every mother is hand-to-mouth,
But you’re so lucky not to know
If you want to find me, stranger
There’s a holy boat we could share,
But if it feels like spinning wheels
While we continue only to drown
Then you must excuse me if I steal
The remaining jewels from your crown

How desperate we are
How desperate we are
And if you want to know how close to the bottom
Just count the churches, jails, & bars

How desperate we are
How desperate we are
And if you want to know how close to the bottom
Just count the churches, jails, & bars`
  },
  {
    title: "Jules Can You See Me?",
    file: "audio/06 Jules Can You See Me__.mp3",
    notes: "(add notes later)",
    credits: "(add credits later)",
    lyrics: `Jules, can you see me?
I’m right before your eyes
Here lonely, sick, & haunted
Wishing for a different life
And I don’t know how you missed me
I’ve been waving my arms around
Like a fool, sad & desperate
Wishing I was with you now

Was with you now…
Can you see me? Am I here?
With you now…
How can I reappear? Reappear…

Jules, can you see me?
I’m right in plain sight
I’ve been sitting here in solitude for most of my life
Can you tell me am I someone?
Am I worth your time at all?
Or would you block my number if I got brave enough to call?

Brave enough to call…
Can you see me? Am I here?
Enough to call…
How can I reappear? Reappear…

And all night I’m waiting to be seen
And alright you’ve got me walking in a dream of you and me

Jules, can you see me?
Have I disappeared again?
I know you came here to be social with some of your closest friends
But I’m walking right up to you
Flashing my pearly whites
Oh please take me with you
Off into this sunken night

This drunken night…
Can you see me? Am I here?
This drunken night…
How can I reappear? Reappear…

And all night I’m waiting to be seen
And alright you’ve got me walking in a dream of you and me

Jules, can you see me?
They’re locking up the doors
Tell me where are we going
Is it my place or yours?
But you broke off towards the theater
And I turned off towards the park,
But in a sense you took me with you
Jules, you took my heart

You took my heart…
Can you see me? Am I here?
You took my heart…
How can I reappear? Reappear?`
  },
  {
    title: "Something is Different",
    file: "audio/07 Something is Different.mp3",
    notes: "(add notes later)",
    credits: "(add credits later)",
    lyrics: `Something went missing from your eyes
And I’ve been looking for it ever since
The years we spent building memories
May be all that we get

Something is different
Something is different
Something is different
And something’s gotta change

Whatever pulled me close to you
A lover’s serenade
Has fallen quiet despite my demands
And the band they just won’t play

Something is different
Something is different
Something is different
And something’s gotta change

When we met and fell madly in love
The first time you touched my hand
Now that it’s fading nothing’s enough
And I just don’t know who I am

Something is different
Something is different
Something is different
And something’s gotta change

Everybody told me that it would never last
And I was sure they were wrong
It breaks my heart how right they were
And How love evaporates like fog

And..
Something is different
Something is different
Something is different
And something’s gotta change`
  },
  {
    title: "Our Remaining Pig",
    file: "audio/08 Our Remaining Pig.mp3",
    notes: "(add notes later)",
    credits: "(add credits later)",
    lyrics: `There is a place in this world calling out my name
It might be love, it might be death, it might be pain
But there’s no way I’m staying here treading this water
We must slaughter our remaining pig

Forward, forward
Darling, I loved you
Deep in the wreckage, honey,
That’s the truth
Twisted and broken,
But it’s the only way through
And it kills me to kill you,
But that’s what we do
That’s what we do

Don’t know how long you starved me, but here is the bones
You can see them in the museum, but the animal is gone
And it ain’t your fault
It’s just this wicked world won’t quit breaking everything
And it broke my heart with it

Forward, forward
Darling, I loved you
Deep in the wreckage, honey,
That’s the truth
Twisted and broken,
But it’s the only way through
And it kills me to kill you,
But that’s what we do
That’s what we do

Drift away now
You’ve got to be free
I pray and I shout that good things come to me
Can good things come to me?
Will good things come to me?

Forward, forward
Darling, I loved you
Deep in the wreckage, honey,
That’s the truth
Twisted and broken,
But it’s the only way through
And it kills me to kill you,
But that’s what we do
That’s what we do`
  },
  {
    title: "The Mouth That Will Not Speak",
    file: "audio/09 The Mouth That Will Not Speak.mp3",
    notes: "(add notes later)",
    credits: "(add credits later)",
    lyrics: `Thought I heard a voice once before
Oh I thought it was yours
Thought I heard a voice once before
Oh I thought it was yours

Have at you!
I could tear you apart
In very little time I could own your heart
I’m made of teeth
You can wait and see,
But you’re looking at a mouth that will not speak

You’re looking at a mouth that will not speak
You’re coming into town to ask after me,
But I’m out the door
I’m down the street
You keep looking into my eyes like there’s something to see

I don’t need a vacation
I just want to believe
That there’s more out there that my hands can reach
Another falling curtain
Another dimming light
A dog on the runway’s had the time of his life
And I just woke up in these dirty sheets
Waiting on the mouth that will not speak

You’re looking at a mouth that will not speak
You’re coming into town to ask after me,
But I’m out the door
I’m down the street
You keep looking into my eyes like there’s something to see

Thought I heard a voice once before…`
  },
  {
    title: "Pain",
    file: "audio/10 Pain.mp3",
    notes: "(add notes later)",
    credits: "(add credits later)",
    lyrics: `What do you do with your pain?
What do you do with your troubled mind?
Do you just look away?
Or do you pull out your eyes?

Pain
Pain
Pain

What do you do with your past?
What do you do when the day replays?
Can you escape its grasp?
Can you send it packing the way that it came?

Pain
Pain
Pain

What do you do with your lust?
What do you do with your hungry eyes?
Do you just want too much?
Do you really want another life?

Pain
Pain
Pain

PAIN!
PAIN!
PAIN!`
  },
  {
    title: "We Were Right ('Til We Were Wrong)",
    file: "audio/11 We Were Right ('Til We Were Wrong).mp3",
    notes: "(add notes later)",
    credits: "(add credits later)",
    lyrics: `It happens slow
The dying flame
And where it goes there’s no escape
And we’re just whores
Hearts made for rape
The angel’s harp only played mistakes

I thought we’d be forever
I guess I’m just that dumb
And I said no to tomorrow
Like I could turn my back and run
We once adored these old oak floors,
But the luster now is gone
And it’s true the shine just fades with time
We were right ‘till we were wrong

Turn out the lights
Deny the sun
Turn on our phones
We’ll call this love
Maybe in your youth
With bright blue eyes
Before the truth stole surprise

I thought we’d be forever
I guess I’m just that dumb
And I said no to tomorrow
Like I could turn my back and run
We once adored these old oak floors,
But the luster now is gone
And it’s true the shine just fades with time
We were right ‘till we were wrong

I thought we’d be forever
I guess I’m just that dumb
And I said no to tomorrow
Like I could turn my back and run
We once adored these old oak floors,
But the luster now is gone
And it’s true the shine just fades with time
We were right ‘till we were wrong`
  },
  {
    title: "Cut Off All Your Hair",
    file: "audio/12 Cut Off All Your Hair.mp3",
    notes: "(add notes later)",
    credits: "(add credits later)",
    lyrics: `Thought I could outrun every wild dog
Cover myself in clouds & hide in the fog
Thought if I left you’d forget my name
Even though the splinter was stuck in my paw
I refused to flinch
Just kept on walking
It’s I that drives the stake
And it’s not like I didn’t know what I needed to do
I just said no
Watch me stop the world from spin
It’s never been my way to ask for help
Though I needed it bad
I kept it to myself
That way no one could let me down

And would you please cut off all your hair?
And stand by my side though I can get so scared?
And would you leave as I just start to care?
‘Cause there’s a beggar in me that wants nothing but you, dear

Danced my way right out of the spotlight
Jitterbug to the grave ‘till the bulbs glow hot white
Thought I’d just let go of your hand
Whatever became of that brand new feeling
That just never came back despite all my wishing
Blew out the candles on the cake
Countless nights of endless drinking
They gave away love without even thinking
They sell it at the corner store
And God only lasts in the moment you hold it
Man, it gets away fast with nothing to show for it
Hold this picture of my life

And would you please cut off all your hair?
And stand by my side though I can get so scared?
And would you leave as I just start to care?
‘Cause there’s a beggar in me that wants nothing but you, dear`
  },
];

// -------------------------------------

const audio = document.getElementById("audio");
const list = document.getElementById("trackList");

const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");
const playPauseBtn = document.getElementById("playPauseBtn");
const nowPlaying = document.getElementById("nowPlaying");

let currentIndex = -1;

function urlFor(path) {
  return path
    .split("/")
    .map((seg) => encodeURIComponent(seg))
    .join("/");
}

function setPlayButtonLabel() {
  if (!playPauseBtn) return;
  playPauseBtn.textContent = audio.paused ? "Play" : "Pause";
}

function setNowPlaying() {
  if (!nowPlaying) return;
  nowPlaying.textContent = currentIndex >= 0 ? `Now playing: ${tracks[currentIndex].title}` : "";
}

function setPlayingHighlight(index) {
  [...list.querySelectorAll(".track")].forEach((el, i) => {
    el.classList.toggle("playing", i === index);
  });
}

function playIndex(index) {
  const t = tracks[index];
  if (!t) return;

  currentIndex = index;
  audio.src = urlFor(t.file);
  audio.play().catch(() => {});
  setNowPlaying();
  setPlayingHighlight(index);
  setPlayButtonLabel();
}

function playNext() {
  if (currentIndex < 0) return playIndex(0);
  const next = currentIndex + 1;
  if (next < tracks.length) playIndex(next);
}

function playPrev() {
  if (currentIndex < 0) return;
  if (audio.currentTime > 3) {
    audio.currentTime = 0;
    return;
  }
  const prev = currentIndex - 1;
  if (prev >= 0) playIndex(prev);
}

function togglePlayPause() {
  if (currentIndex < 0) return playIndex(0);
  if (audio.paused) audio.play().catch(() => {});
  else audio.pause();
}

// ----- Track modal -----
const trackModal = document.getElementById("trackModal");
const trackModalKicker = document.getElementById("trackModalKicker");
const trackModalTitle = document.getElementById("trackModalTitle");
const trackModalBody = document.getElementById("trackModalBody");
const trackModalCloseBtn = document.getElementById("trackModalCloseBtn");

let lastFocusEl = null;

function openTrackModal(trackTitle, sectionLabel, bodyText) {
  lastFocusEl = document.activeElement;

  trackModalKicker.textContent = sectionLabel;
  trackModalTitle.textContent = trackTitle;
  trackModalBody.textContent = bodyText || "(empty)";

  trackModal.classList.add("open");
  trackModal.setAttribute("aria-hidden", "false");
  trackModalCloseBtn?.focus();
}

function closeTrackModal() {
  trackModal.classList.remove("open");
  trackModal.setAttribute("aria-hidden", "true");
  if (lastFocusEl && typeof lastFocusEl.focus === "function") lastFocusEl.focus();
}

trackModal?.addEventListener("click", (e) => {
  if (e.target && e.target.dataset && e.target.dataset.close === "1") closeTrackModal();
});
trackModalCloseBtn?.addEventListener("click", closeTrackModal);

// ----- Artist bio modal -----
const bioBtn = document.getElementById("bioBtn");
const bioModal = document.getElementById("bioModal");
const bioCloseBtn = document.getElementById("bioCloseBtn");
const bioBody = document.getElementById("bioBody");

function openBio() {
  lastFocusEl = document.activeElement;
  bioBody.textContent = artistBio || "(no bio yet)";
  bioModal.classList.add("open");
  bioModal.setAttribute("aria-hidden", "false");
  bioCloseBtn?.focus();
}

function closeBio() {
  bioModal.classList.remove("open");
  bioModal.setAttribute("aria-hidden", "true");
  if (lastFocusEl && typeof lastFocusEl.focus === "function") lastFocusEl.focus();
}

bioBtn?.addEventListener("click", openBio);
bioModal?.addEventListener("click", (e) => {
  if (e.target && e.target.dataset && e.target.dataset.close === "1") closeBio();
});
bioCloseBtn?.addEventListener("click", closeBio);

// global esc closes whichever modal is open
document.addEventListener("keydown", (e) => {
  if (e.key !== "Escape") return;
  if (trackModal?.classList.contains("open")) closeTrackModal();
  if (bioModal?.classList.contains("open")) closeBio();
});

// ----- Per-track menu rows -----
function closeAllMenus(except = null) {
  document.querySelectorAll(".navrow.open").forEach((row) => {
    if (row !== except) row.classList.remove("open");
  });
  document.querySelectorAll(".menubtn").forEach((b) => {
    const li = b.closest(".track");
    const row = li ? li.querySelector(".navrow") : null;
    b.setAttribute("aria-expanded", row && row.classList.contains("open") ? "true" : "false");
    b.textContent = row && row.classList.contains("open") ? "✕" : "≡";
  });
}

document.addEventListener("click", () => closeAllMenus());

function buildList() {
  list.innerHTML = "";

  tracks.forEach((t, i) => {
    const li = document.createElement("li");
    li.className = "track";

    // Row
    const top = document.createElement("div");
    top.className = "track-top";

    // Left: play button
    const left = document.createElement("div");
    const playBtn = document.createElement("button");
    playBtn.type = "button";

    const name = document.createElement("div");
    name.className = "name";
    name.textContent = `${String(i + 1).padStart(2, "0")}. ${t.title}`;

    const meta = document.createElement("div");
    meta.className = "meta";
    meta.textContent = "click to play";

    playBtn.appendChild(name);
    playBtn.appendChild(meta);

    playBtn.addEventListener("click", () => playIndex(i));

    left.appendChild(playBtn);

    // Right: download + menu icon
    const actions = document.createElement("div");
    actions.className = "track-actions";

    const download = document.createElement("a");
    download.href = urlFor(t.file);
    download.setAttribute("download", "");
    download.textContent = "Download";
    download.className = "downloadbtn";
    download.addEventListener("click", (e) => e.stopPropagation());

    const menuBtn = document.createElement("button");
    menuBtn.type = "button";
    menuBtn.className = "iconbtn menubtn";
    menuBtn.textContent = "≡";
    menuBtn.setAttribute("aria-expanded", "false");
    menuBtn.setAttribute("aria-label", "Open track menu");
    menuBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      const row = li.querySelector(".navrow");
      const willOpen = !row.classList.contains("open");
      closeAllMenus(willOpen ? row : null);
      if (willOpen) row.classList.add("open");
      closeAllMenus(willOpen ? row : null); // ensures icon state updates
    });

    actions.appendChild(download);
    actions.appendChild(menuBtn);

    top.appendChild(left);
    top.appendChild(actions);

    // Nav row (buttons)
    const navrow = document.createElement("div");
    navrow.className = "navrow";
    navrow.addEventListener("click", (e) => e.stopPropagation());

    const mkNav = (label, sectionKey) => {
      const b = document.createElement("button");
      b.type = "button";
      b.className = "navchip";
      b.textContent = label;

      b.addEventListener("click", () => {
        const body =
          sectionKey === "lyrics" ? t.lyrics :
          sectionKey === "credits" ? t.credits :
          t.notes;

        openTrackModal(t.title, label, body);
      });

      return b;
    };

    navrow.appendChild(mkNav("Lyrics", "lyrics"));
    navrow.appendChild(mkNav("Credits", "credits"));
    navrow.appendChild(mkNav("Notes", "notes"));

    li.appendChild(top);
    li.appendChild(navrow);

    list.appendChild(li);
  });

  // set initial icon states
  closeAllMenus();
}

prevBtn?.addEventListener("click", playPrev);
nextBtn?.addEventListener("click", playNext);
playPauseBtn?.addEventListener("click", togglePlayPause);

audio.addEventListener("play", setPlayButtonLabel);
audio.addEventListener("pause", setPlayButtonLabel);
audio.addEventListener("ended", () => {
  const next = currentIndex + 1;
  if (next < tracks.length) playIndex(next);
  else setPlayButtonLabel();
});

buildList();
setPlayButtonLabel();
setNowPlaying();
